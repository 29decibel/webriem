<%= form_for @doc_head,:remote=>true,:html => { :multipart => true } do |f| %>
<div class="form_title">
	<h3><%= @title%></h3>
</div>
<div id="doc_head_actions" class="actions">
	<%= render :partial=>"doc_head_actions",:locals=>{:doc_head=>@doc_head}%>
</div>
<div id="doc_state_process">
	<%= render :partial=>"doc_state_process",:locals=>{:doc=>@doc_head}%>
</div>
<div class="form_title">
	<h3>基本信息</h3>
</div>
<div class="form_area">
	<div class="form_block">
		<div class="form_field">
			<%= f.label "单号" %>
			<%= f.text_field :doc_no,:class=>"input1"+ mark_required(@doc_head, :doc_no) %>
		</div>
		<div class="form_field">
			<%= f.label "申请人" %>
			<%= f.hidden_field :person_id %>
			<%= @doc_head.person_name%>
		</div>
	</div>
	<% if @doc_head.doc_type>4 %>
	<div class="form_block">
		<div class="form_field">
			<%= f.label "部门" %>
			<%= collection_select(:doc_head, :dep_id, Dep.all, :id, :name, {:include_blank => '无'},{:class=>"input1"})%>
		</div>
		<div class="form_field">
			<%= f.label "费用类型" %>
			<%= collection_select(:doc_head, :fee_id, Fee.all, :id, :name, {:include_blank => '无'},{:class=>"input1"})%>
		</div>
	</div>	
	<% end %>
	<div class="form_block">
		<div class="form_field">
			<%= f.label "申请日期" %>
			<%= f.text_field :apply_date,:class=>"datepicker input1" %>
		</div>
		<div class="form_field">
			<%= f.label "附件个数" %>
			<%= f.text_field :attach,:class=>"input1"+ mark_required(@doc_head, :attach) %>  
		</div>
	</div>
	<div class="form_block">
		<div class="form_field">
			<%= f.label "备注" %>
			<%= f.text_field :note,:class=>"input2"+ mark_required(@doc_head, :note) %>
		</div>
	</div>
	<!---++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<div class="flow_area_field">
		<%= f.label "项目",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.select :project_id,Project.all.collect {|s| [ s.name, s.id ] },{:include_blank => '无'},{:class=>"basic_input"}%>
		</div>	
	</div>
	<div class="flow_area_field">
		<%= f.label "费用描述",:class=>"input_label" %>
		<div class="input_area size4">
			<%= f.text_field :reim_description,:class=>"normal" %>  
		</div>	
	</div>
	<div class="flow_area_field">
		<%= f.label "是否分摊",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.select :is_split, ReimDetail::ENUMS_IS_SPLIT,{},{:class=>"basic_input is_split_reim"} %>
		</div>	
	</div>
	<div class="flow_area_field">
		<%= f.label "币种",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.select :currency_id ,Currency.all.collect{|c|[c.name,c.id]},{},{:class=>"basic_input"}%>  
		</div>	
	</div>
	<div class="flow_area_field">
		<%= f.label "汇率",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.text_field :rate,:class=>"normal rate" %>  
		</div>	
	</div>
	<div class="flow_area_field">
		<%= f.label "原币金额",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.text_field :ori_amount,:class=>"normal ori_amount" %>  
		</div>	
	</div>
	<div class="flow_area_field">
		<%= f.label "申请金额",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.text_field :apply_amount,:class=>"normal amount" %>  
		</div>	
	</div>

	<div class="flow_area_field">
		<%= f.label "实际金额",:class=>"input_label" %>
		<div class="input_area size2">
			<%= f.text_field :real_amount,:class=>"normal" %>  
		</div>	
	</div>	
	<%= f.hidden_field :doc_type%>
</div>
<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<!--根据不同的单据类型render不同的单据-->
<div id="details" class="form_area">
	<!---->
	<% if @doc_head.doc_type<=2%>
	<div class="form_title">
		<h3><%= @doc_head.doc_type==1 ? "借款单据明细":"付款单据明细" %></h3>
	</div>
	<div class="table_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>申请时间</th>
				    <th>部门</th>
				    <th>费用类型</th>
				    <th>项目</th>
				    <th>费用用途</th>
				    <th>币种</th>
					<th>汇率</th>
					<th>原币金额</th>
					<th>申请金额</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<% f.fields_for :cp_doc_details do |builder|  %>
					<%= render :partial => 'cp_doc_detail_fields',:locals => { :f => builder } %>
				<% end %>
			</tbody>
			<tr>
				<td colspan="8"><%= link_to_add_fields "添加明细",f,:cp_doc_details %></td>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>	
	<% end %>
	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type==3%>
	<div class="form_title">
		<h3>收款明细</h3>
	</div>
	<div class="table_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>申请时间</th>
				    <th>部门</th>
				    <th>项目</th>
				    <th>收款内容</th>
					<th>收款金额</th>
				    <th>币种</th>
					<th>汇率</th>
					<th>原始金额</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<% f.fields_for :rec_notice_details do |builder| %>
					<%= render :partial => 'rec_notice_detail_fields',:locals => { :f => builder } %>
				<% end %>				
			</tbody>
			<tr>
				<th colspan="7"><%= link_to_add_fields "添加收款明细",f,:rec_notice_details %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>		
	</div>
	<% end %>
	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type<=3%>
	<div class="form_title">
		<h3>收款人明细</h3>
	</div>
	<div class="table_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>结算方式</th>
				    <th>收款单位</th>
				    <th>银行</th>
				    <th>银行帐号</th>
				    <th>金额</th>	
					<th></th><!--给删除的-->		    
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :recivers do |builder|  %>
					<%= render :partial => 'reciver_fields',:locals => { :f => builder }  %>
				<% end %>
			</tbody>
			<tr>
				<th colspan="8"><%= link_to_add_fields "添加收款人",f,:recivers %></th>
			</tr>		
		</table>
	</div>	
	<% end %>
	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->	
	<!--结汇申请单-->
	<% if @doc_head.doc_type==4%>
	<div class="form_title">
		<h3>结汇申请详细</h3>
	</div>
	<div id="inner_remittance">
		<%= f.fields_for :inner_remittance do |builder|  %>
			<%= render :partial => 'inner_remittance',:locals => { :f => builder }  %>
		<% end %>
	</div>
	<% end %>
	<!--转帐申请单-->
	<% if @doc_head.doc_type==5%>
	<div class="form_title">
		<h3>转帐申请详细</h3>
	</div>
	<div id="inner_transfer">
		<%= f.fields_for :inner_transfer do |builder|  %>
			<%= render :partial => "inner_transfer",:locals => { :f => builder }  %>
		<% end %>
	</div>
	<% end %>
	<!--现金提取申请单-->
	<% if @doc_head.doc_type==6%>
	<div class="form_title">
		<h3>现金提取申请详细</h3>
	</div>
	<div id="inner_cash_draw">
		<%= f.fields_for :inner_cash_draw do |builder|  %>
			<%= render :partial => "inner_cash_draw",:locals => { :f => builder }  %>
		<% end %>
	</div>
	<% end %>
	<!--购买理财产品-->
	<% if @doc_head.doc_type==7%>
	<div class="form_title">
		<h3>购买理财产品详细</h3>
	</div>
	<div id="buy_finance_products">
		<%= f.fields_for :buy_finance_product do |builder|  %>
			<%= render :partial => "buy_finance_products",:locals => { :f => builder }  %>
		<% end %>
	</div>
	<% end %>
	<!--赎回理财产品-->
	<% if @doc_head.doc_type==8%>
	<div class="form_title">
		<h3>赎回理财产品详细</h3>
	</div>
	<div id="redeem_finance_products">
		<%= f.fields_for :redeem_finance_product do |builder|  %>
			<%= render :partial => "redeem_finance_products",:locals => { :f => builder }  %>
		<% end %>
	</div>
	<% end %>
	<!--here is reim details...................................................-->
	<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type==9%>
		<div class="rd_travel rdd_details">
			<table class="form_input">
				<thead>
					<tr>	
						<th>序号</th>
					    <th>出差天数</th>
					    <th>出差地点</th>
					    <th>出差事由</th>
					    <th>费用标准</th>
						<th>其他费用</th>
					    <th>其他费用说明</th>
						<th>申请费用</th>
						<th>HR调整</th>
						<th>财务调整</th>
						<th></th><!--给删除的-->
				    </tr>
			    <thead>
				<tbody>
					<%= f.fields_for :rd_travels do |builder| %>
						<%= render :partial => 'rd_travel_fields',:locals => { :f => builder } %>
					<% end %>				
				</tbody>
				<tr>
					<th colspan="8"><%= link_to_add_fields "添加差旅补助费用",f,:rd_travels %></th>
					<td>申请金额合计</td>
					<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
					<td></td>
				</tr>		
			</table>
		</div>
		<div class="rd_transport rdd_details">
			<table class="form_input">
				<thead>
					<tr>					
						<th>序号</th>
					    <th>开始时间</th>
					    <th>到达时间</th>
					    <th>出发地</th>
					    <th>目的地</th>
						<th>出差事由</th>
					    <th>交通工具</th>
						<th>申请费用</th>
						<th>HR调整</th>
						<th>财务调整</th>
						<th></th><!--给删除的-->
				    </tr>
			    <thead>
				<tbody>
					<%= f.fields_for :rd_transports do |builder|  %>
						<%= render :partial => 'rd_transport_fields',:locals => { :f => builder }  %>
					<% end %>				
				</tbody>
				<tr>
					<th colspan="8"><%= link_to_add_fields "添加交通费",f,:rd_transports %></th>
					<td>申请金额合计</td>
					<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
					<td></td>
				</tr>		
			</table>					
		</div>
		<div class="rd_loding rdd_details">
			<table class="form_input">
				<thead>
					<tr>					
						<th>序号</th>
					    <th>住宿天数</th>
					    <th>城市</th>
					    <th>住宿日期</th>
					    <th>费用标准</th>
						<th>人数</th>
					    <th>合住人</th>
						<th>申请费用</th>
						<th>HR调整</th>
						<th>财务调整</th>
						<th></th><!--给删除的-->
				    </tr>
			    <thead>
				<tbody>
					<%= f.fields_for :rd_lodgings do |builder|  %>
						<%= render :partial => 'rd_lodging_fields',:locals => { :f => builder }  %>
					<% end %>				
				</tbody>
				<tr>
					<th colspan="8"><%= link_to_add_fields "添加住宿费",f,:rd_lodgings %></th>
					<td>申请金额合计</td>
					<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
					<td></td>
				</tr>		
			</table>
		</div>
	<% end %>
	<!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type==10%>
	<div class="rd_work_meal rdd_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>地点</th>
				    <th>日期</th>
				    <th>人数</th>
				    <th>参与人姓名</th>
					<th>事由</th>
				    <th>申请费用</th>
					<th>HR调整</th>
					<th>财务调整</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :rd_work_meals do |builder|  %>
					<%= render :partial => 'rd_work_meal_fields',:locals => { :f => builder }  %>
				<% end %>				
			</tbody>
			<tr>
				<th colspan="8"><%= link_to_add_fields "添加工作餐费",f,:rd_work_meals %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>
	<% end %>
	<!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type==11%>
	<div class="rd_extra_work_meal rdd_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>日期</th>
				    <th>是否休息日</th>
					<th>开始时间</th>
				    <th>结束时间</th>
					<th>事由</th>
					<th>申请费用</th>
					<th>HR调整</th>
					<th>财务调整</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :rd_extra_work_meals do |builder|  %>
					<%= render :partial => 'rd_extra_work_meal_fields',:locals => { :f => builder }  %>
				<% end %>			
			</tbody>
			<tr>
				<th colspan="8"><%= link_to_add_fields "添加加班餐费",f,:rd_extra_work_meals %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>
	<div class="rd_extra_work_car rdd_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>日期</th>
				    <th>是否休息日</th>
				    <th>开始地点</th>
				    <th>结束地点</th>
					<th>开始时间</th>
				    <th>结束时间</th>
					<th>事由</th>
					<th>申请费用</th>
					<th>HR调整</th>
					<th>财务调整</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :rd_extra_work_cars do |builder|  %>
					<%= render :partial => 'rd_extra_work_car_fields',:locals => { :f => builder }  %>
				<% end %>				
			</tbody>
			<tr>
				<th colspan="9"><%= link_to_add_fields "添加加班交通费",f,:rd_extra_work_cars %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>
	<% end %>
	<!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type==13%>
	<div class="rd_common_transport rdd_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>日期</th>
				    <th>开始地点</th>
				    <th>结束地点</th>
					<th>开始时间</th>
				    <th>结束时间</th>
					<th>事由</th>
					<th>申请费用</th>
					<th>HR调整</th>
					<th>财务调整</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :rd_common_transports do |builder|  %>
					<%= render :partial => 'rd_common_transport_fields',:locals => { :f => builder }  %>
				<% end %>				
			</tbody>
			<tr>
				<th colspan="8"><%= link_to_add_fields "添加业务交通费",f,:rd_common_transports %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>
	<% end %>
	<!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type==14%>
	<div class="rd_benefit rdd_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>报销日期</th>
				    <th>人数</th>
				    <th>费用期间</th>
				    <th>申请费用</th>
					<th>附件</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :rd_benefits do |builder|  %>
					<%= render :partial => 'rd_benefit_fields',:locals => { :f => builder }  %>
				<% end %>			
			</tbody>
			<tr>
				<th colspan="8"><%= link_to_add_fields "添加福利费用",f,:rd_benefits %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>
	<% end %>
	<!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
	<% if @doc_head.doc_type>=9%>
	<!--分摊明细动态显示-->
	<div class="reim_split_details">
		<table class="form_input">
			<thead>
				<tr>					
					<th>序号</th>
				    <th>部门</th>							    
				    <th>项目</th>
					<th>费用类型</th>
				    <th>百分比</th>
					<th></th><!--给删除的-->
			    </tr>
		    <thead>
			<tbody>
				<%= f.fields_for :reim_split_details do |builder|  %>
					<%= render :partial => "reim_split_detail_fields",:locals => { :f => builder }  %>
				<% end %>				
			</tbody>
			<tr>
				<th colspan="8"><%= link_to_add_fields "添加分摊明细",f,:reim_split_details %></th>
				<td>申请金额合计</td>
				<td><%= text_field_tag 'total_amount', nil, :class => 'total_amount normal'%></td>
				<td></td>
			</tr>		
		</table>
	</div>
	<% end %>
</div>
<% end %>
<!--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<!--审批流++++++++根据当前单据状态以及当前审批人显示下面内容-->
<div id="work_flow_info">
	<%= render(:partial=>"work_flow_info",:locals=>{:work_flow_info=>@work_flow_info,:doc_head=>@doc_head})%>
</div>